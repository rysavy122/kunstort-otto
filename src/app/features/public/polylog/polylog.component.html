<div id="wrapper">
  <div id="button-div" *ngIf="!freezePolylog">
    <button (click)="openDialog()" class="comment-button">Kommentieren</button>
    <input style="display: none;" type="file" (change)="onMediaSelected($event)" accept="image/*,video/*,audio/*" #fileInput>

    <button *ngIf="!selectedMedia" class="comment-button" (click)="fileInput.click()">
      <i class="fa fa-cloud-upload"></i> Custom Upload
    </button>

    <button *ngIf="selectedMedia" (click)="uploadMedia()" class="comment-button">Upload: {{ selectedMedia?.name }}</button>
    <button *ngIf="selectedMedia" (click)="cancelUpload()" class="comment-button">Cancel</button>
  </div>

  <h1 id="forschungsfrage">{{ forschungsfrage }}</h1>
  <img
  *ngIf="imagePath"
  class="forschungsfrage-logo"
  [src]="imagePath"
  alt="Uploaded Image"
/>
  <ng-container *ngFor="let kommentar of kommentare; trackBy: trackById">
    <ng-container
      *ngTemplateOutlet="commentTemplate; context: { $implicit: kommentar }"
    ></ng-container>
  </ng-container>

<!-- Displaying Uploaded Media -->
<div *ngFor="let mediaUrl of mediaUrls">
  <!-- Display image -->
  <img *ngIf="isImage(mediaUrl)" [src]="mediaUrl" alt="Uploaded Image" />

  <!-- Display video -->
  <video *ngIf="isVideo(mediaUrl)" controls>
    <source [src]="mediaUrl" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <!-- Display audio -->
  <audio *ngIf="isAudio(mediaUrl)" controls>
    <source [src]="mediaUrl" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>
</div>

  <app-comment-dialog
    #commentDialog
    [isOpen]="isDialogOpen"
    (close)="closeDialog()"
    (commentSubmitted)="onCommentSubmitted($event)"
  >
  </app-comment-dialog>

  <ng-template #commentTemplate let-comment let-isReply="isReply">
    <div
      #draggableElement
      class="commentar"
      [ngStyle]="comment.style"
      [class.commentar]="!isReply"
      [class.replies]="isReply"
    >
      <h4>{{ comment.title }}</h4>
      <p [innerHTML]="getSafeHtml(comment.comment)"></p>
      <p>Datum: {{ comment.createdAt | date }}</p>
      <br />
      <div class="icons">
        <svg
          (click)="toggleMenu(comment.id!)"
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          class="bi bi-three-dots"
          viewBox="0 0 16 16"
        >
          <path
            d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"
          />
        </svg>
        <div
          *ngIf="isMenuOpen && activeCommentId === comment.id"
          class="menu"
          [class.menu]="!isReply"
          [class.reply-menu]="isReply"
          [class.show]="isMenuOpen"
        >
          <button (click)="editKommentar(comment.id)">Edit</button>
          <button (click)="openReplyDialog(comment.id)">Reply</button>
          <button (click)="deleteKommentar(comment.id)">Delete</button>
        </div>
      </div>
    </div>
    <div *ngIf="comment.replies && comment.replies.length">
      <ng-container
        class="replies"
        *ngFor="let reply of comment.replies; trackBy: trackById"
      >
        <ng-container
          *ngTemplateOutlet="
            commentTemplate;
            context: { $implicit: reply, isReply: true }
          "
        ></ng-container>
      </ng-container>
    </div>
  </ng-template>
</div>
